{"version":3,"file":"index.vue2.mjs","sources":["../../../../../../packages/preview/supports/epub-preview/index.vue"],"sourcesContent":["<script lang='ts' setup>\r\nimport {ref, watch} from 'vue'\r\nimport ePub from 'epubjs'\r\nimport type {PreviewProps} from '../../preview.interface'\r\nimport {getFileRenderByFile} from '../../utils/utils'\r\n\r\nconst props = withDefaults(\r\n    defineProps<PreviewProps & {\r\n      width?: string\r\n      height?: string\r\n    }>(),\r\n    {\r\n      url: () => null,\r\n      file: () => null,\r\n      width: () => '100%',\r\n      height: () => '100%',\r\n    },\r\n)\r\n\r\nconst navigation = ref()\r\nconst locations = ref()\r\nconst currentPage = ref(1)\r\nconst totalPages = ref()\r\nconst bookAvailable = ref(false)\r\nconst book = ref()\r\nconst rendition = ref()\r\n\r\nfunction initEpub(): void {\r\n  if (props.file) {\r\n    getFileRenderByFile(props.file).then((render) => {\r\n      book.value = ePub(render as ArrayBuffer)\r\n      rendition.value = book.value.renderTo('epub-viewer', {\r\n        // Scroll mode\r\n        width: '100%',\r\n        height: 'calc(100vh - 80x)',\r\n        flow: 'scrolled',\r\n        allowScriptedContent: true,\r\n      })\r\n      book.value.ready.then(() => {\r\n        navigation.value = book.value.navigation\r\n        locations.value = book.value.locations\r\n        bookAvailable.value = true\r\n        // Get the total number of pages\r\n        totalPages.value = locations.value.length()\r\n        rendition.value.display()\r\n      })\r\n    })\r\n  }\r\n}\r\n\r\nwatch(\r\n    () => props.file,\r\n    () => {\r\n      initEpub()\r\n    },\r\n    {immediate: true},\r\n)\r\n\r\n// epub翻页\r\nfunction prevPage(): void {\r\n  if (rendition.value) {\r\n    rendition.value.prev()\r\n    // Update when page forward currentPage\r\n    currentPage.value--\r\n    if (currentPage.value < 1) {\r\n      currentPage.value = 1\r\n    }\r\n  }\r\n}\r\n\r\nfunction nextPage(): void {\r\n  if (rendition.value) {\r\n    rendition.value.next()\r\n    // Update when turning back page currentPage\r\n    currentPage.value++\r\n    if (currentPage.value > totalPages.value) {\r\n      currentPage.value = totalPages.value\r\n    }\r\n  }\r\n}\r\n\r\nfunction prevKeyDown(e): void {\r\n  e.preventDefault()\r\n}\r\n\r\nfunction downKeyDown(e): void {\r\n  e.preventDefault()\r\n}\r\n\r\nonKeyStroke('ArrowLeft', () => {\r\n  prevPage()\r\n})\r\n\r\nonKeyStroke('ArrowRight', () => {\r\n  nextPage()\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"epub-preview epub-box\" :style=\"{ width, height }\">\r\n    <button class=\"btn\" style=\"display: none\" @keydown=\"prevKeyDown\">\r\n      Prev\r\n    </button>\r\n    <div id=\"epub-viewer\" class=\"epub-viewer\"/>\r\n    <button class=\"btn\" style=\"display: none\" @keydown=\"downKeyDown\">\r\n      Next\r\n    </button>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.epub-box {\r\n  height: 100vh;\r\n  width: 100%;\r\n}\r\n\r\n.epub-viewer {\r\n  padding: 10px;\r\n  min-height: calc(100vh - 80px);\r\n  max-height: calc(100vh - 80px);\r\n  overflow: auto;\r\n}\r\n\r\n.footer {\r\n  height: 24px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding: 10px;\r\n}\r\n</style>\r\n"],"names":["props","__props","navigation","ref","locations","currentPage","totalPages","bookAvailable","book","rendition","initEpub","getFileRenderByFile","render","ePub","watch","prevPage","nextPage","prevKeyDown","downKeyDown","onKeyStroke"],"mappings":";;;;;;;;;;;;;;;;;;;;AAMA,UAAMA,IAAQC,GAaRC,IAAaC,EAAA,GACbC,IAAYD,EAAA,GACZE,IAAcF,EAAI,CAAC,GACnBG,IAAaH,EAAA,GACbI,IAAgBJ,EAAI,EAAK,GACzBK,IAAOL,EAAA,GACPM,IAAYN,EAAA;AAElB,aAASO,IAAiB;AACxB,MAAIV,EAAM,QACRW,EAAoBX,EAAM,IAAI,EAAE,KAAK,CAACY,MAAW;AAC/C,QAAAJ,EAAK,QAAQK,EAAKD,CAAqB,GACvCH,EAAU,QAAQD,EAAK,MAAM,SAAS,eAAe;AAAA;AAAA,UAEnD,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,sBAAsB;AAAA,QAAA,CACvB,GACDA,EAAK,MAAM,MAAM,KAAK,MAAM;AAC1B,UAAAN,EAAW,QAAQM,EAAK,MAAM,YAC9BJ,EAAU,QAAQI,EAAK,MAAM,WAC7BD,EAAc,QAAQ,IAEtBD,EAAW,QAAQF,EAAU,MAAM,OAAA,GACnCK,EAAU,MAAM,QAAA;AAAA,QAClB,CAAC;AAAA,MACH,CAAC;AAAA,IAEL;AAEA,IAAAK;AAAA,MACI,MAAMd,EAAM;AAAA,MACZ,MAAM;AACJ,QAAAU,EAAA;AAAA,MACF;AAAA,MACA,EAAC,WAAW,GAAA;AAAA,IAAI;AAIpB,aAASK,IAAiB;AACxB,MAAIN,EAAU,UACZA,EAAU,MAAM,KAAA,GAEhBJ,EAAY,SACRA,EAAY,QAAQ,MACtBA,EAAY,QAAQ;AAAA,IAG1B;AAEA,aAASW,IAAiB;AACxB,MAAIP,EAAU,UACZA,EAAU,MAAM,KAAA,GAEhBJ,EAAY,SACRA,EAAY,QAAQC,EAAW,UACjCD,EAAY,QAAQC,EAAW;AAAA,IAGrC;AAEA,aAASW,EAAY,GAAS;AAC5B,QAAE,eAAA;AAAA,IACJ;AAEA,aAASC,EAAY,GAAS;AAC5B,QAAE,eAAA;AAAA,IACJ;AAEA,WAAAC,EAAY,aAAa,MAAM;AAC7B,MAAAJ,EAAA;AAAA,IACF,CAAC,GAEDI,EAAY,cAAc,MAAM;AAC9B,MAAAH,EAAA;AAAA,IACF,CAAC;;;;;;;;;;;;;;;;;;;;;"}