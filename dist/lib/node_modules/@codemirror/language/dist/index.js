"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("../../../@lezer/common/dist/index.js"),h=require("../../state/dist/index.js"),d=require("../../view/dist/index.js"),u=require("../../../@lezer/highlight/dist/index.js"),K=require("../../../style-mod/src/style-mod.js");var H;const v=new p.NodeProp;function ne(n){return h.Facet.define({combine:n?e=>e.concat(n):void 0})}const re=new p.NodeProp;class k{constructor(e,t,r=[],i=""){this.data=e,this.name=i,h.EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(h.EditorState.prototype,"tree",{get(){return b(this)}}),this.parser=t,this.extension=[w.of(this),h.EditorState.languageData.of((o,s,l)=>{let a=Q(o,s,l),c=a.type.prop(v);if(!c)return[];let f=o.facet(c),g=a.type.prop(re);if(g){let y=a.resolve(s-a.from,l);for(let m of g)if(m.test(y,o)){let x=o.facet(m.facet);return m.type=="replace"?x:x.concat(f)}}return f})].concat(r)}isActiveAt(e,t,r=-1){return Q(e,t,r).type.prop(v)==this.data}findRegions(e){let t=e.facet(w);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],i=(o,s)=>{if(o.prop(v)==this.data){r.push({from:s,to:s+o.length});return}let l=o.prop(p.NodeProp.mounted);if(l){if(l.tree.prop(v)==this.data){if(l.overlay)for(let a of l.overlay)r.push({from:a.from+s,to:a.to+s});else r.push({from:s,to:s+o.length});return}else if(l.overlay){let a=r.length;if(i(l.tree,l.overlay[0].from+s),r.length>a)return}}for(let a=0;a<o.children.length;a++){let c=o.children[a];c instanceof p.Tree&&i(c,o.positions[a]+s)}};return i(b(e),0),r}get allowsNesting(){return!0}}k.setState=h.StateEffect.define();function Q(n,e,t){let r=n.facet(w),i=b(n).topNode;if(!r||r.allowsNesting)for(let o=i;o;o=o.enter(e,t,p.IterMode.ExcludeBuffers))o.type.isTop&&(i=o);return i}class B extends k{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=ne(e.languageData);return new B(t,e.parser.configure({props:[v.add(r=>r.isTop?t:void 0)]}),e.name)}configure(e,t){return new B(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function b(n){let e=n.field(k.state,!1);return e?e.tree:p.Tree.empty}class ie{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let A=null;class I{constructor(e,t,r=[],i,o,s,l,a){this.parser=e,this.state=t,this.fragments=r,this.tree=i,this.treeLen=o,this.viewport=s,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new I(e,t,[],p.Tree.empty,0,r,[],null)}startParse(){return this.parser.startParse(new ie(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=p.Tree.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let i=Date.now()+e;e=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(p.TreeFragment.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(p.TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=A;A=this;try{return e()}finally{A=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=X(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:i,treeLen:o,viewport:s,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((c,f,g,y)=>a.push({fromA:c,toA:f,fromB:g,toB:y})),r=p.TreeFragment.applyChanges(r,a),i=p.Tree.empty,o=0,s={from:e.mapPos(s.from,-1),to:e.mapPos(s.to,1)},this.skipped.length){l=[];for(let c of this.skipped){let f=e.mapPos(c.from,1),g=e.mapPos(c.to,-1);f<g&&l.push({from:f,to:g})}}}return new I(this.parser,t,r,i,o,s,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:i,to:o}=this.skipped[r];i<e.to&&o>e.from&&(this.fragments=X(this.fragments,i,o),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends p.Parser{createParse(t,r,i){let o=i[0].from,s=i[i.length-1].to;return{parsedPos:o,advance(){let a=A;if(a){for(let c of i)a.tempSkipped.push(c);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=s,new p.Tree(p.NodeType.none,[],[],s-o)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return A}}function X(n,e,t){return p.TreeFragment.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class C{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new C(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=I.create(e.facet(w).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new C(r)}}k.state=h.StateField.define({create:C.init,update(n,e){for(let t of e.effects)if(t.is(k.setState))return t.value;return e.startState.facet(w)!=e.state.facet(w)?C.init(e.state):n.apply(e)}});let oe=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(oe=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const W=typeof navigator<"u"&&(!((H=navigator.scheduling)===null||H===void 0)&&H.isInputPending)?()=>navigator.scheduling.isInputPending():null,Ee=d.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(k.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(k.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=oe(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:i}}=this.view,o=r.field(k.state);if(o.tree==o.context.tree&&o.context.isDone(i+1e5))return;let s=Date.now()+Math.min(this.chunkBudget,100,e&&!W?Math.max(25,e.timeRemaining()-5):1e9),l=o.context.treeLen<i&&r.doc.length>i+1e3,a=o.context.work(()=>W&&W()||Date.now()>s,i+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(o.context.takeTree(),this.view.dispatch({effects:k.setState.of(new C(o.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(o.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>d.logException(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),w=h.Facet.define({combine(n){return n.length?n[0]:null},enables:n=>[k.state,Ee,d.EditorView.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]});class Me{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const se=h.Facet.define(),G=h.Facet.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function ae(n){let e=n.facet(G);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function le(n,e){let t="",r=n.tabSize,i=n.facet(G)[0];if(i=="	"){for(;e>=r;)t+="	",e-=r;i=" "}for(let o=0;o<e;o++)t+=i;return t}function ce(n,e){n instanceof h.EditorState&&(n=new z(n));for(let r of n.state.facet(se)){let i=r(n,e);if(i!==void 0)return i}let t=b(n.state);return t.length>=e?Be(n,t,e):null}class z{constructor(e,t={}){this.state=e,this.options=t,this.unit=ae(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:o}=this.options;return i!=null&&i>=r.from&&i<=r.to?o&&i==e?{text:"",from:e}:(t<0?i<e:i<=e)?{text:r.text.slice(i-r.from),from:i}:{text:r.text.slice(0,i-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:i}=this.lineAt(e,t);return r.slice(e-i,Math.min(r.length,e+100-i))}column(e,t=1){let{text:r,from:i}=this.lineAt(e,t),o=this.countColumn(r,e-i),s=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return s>-1&&(o+=s-this.countColumn(r,r.search(/\S|$/))),o}countColumn(e,t=e.length){return h.countColumn(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:i}=this.lineAt(e,t),o=this.options.overrideIndentation;if(o){let s=o(i);if(s>-1)return s}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const fe=new p.NodeProp;function Be(n,e,t){let r=e.resolveStack(t),i=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(i!=r.node){let o=[];for(let s=i;s&&!(s.from<r.node.from||s.to>r.node.to||s.from==r.node.from&&s.type==r.node.type);s=s.parent)o.push(s);for(let s=o.length-1;s>=0;s--)r={node:o[s],next:r}}return ue(r,n,t)}function ue(n,e,t){for(let r=n;r;r=r.next){let i=Fe(r.node);if(i)return i(F.create(e,t,r))}return 0}function Oe(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function Fe(n){let e=n.type.prop(fe);if(e)return e;let t=n.firstChild,r;if(t&&(r=t.type.prop(p.NodeProp.closedBy))){let i=n.lastChild,o=i&&r.indexOf(i.name)>-1;return s=>de(s,!0,1,void 0,o&&!Oe(s)?i.from:void 0)}return n.parent==null?Le:null}function Le(){return 0}class F extends z{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new F(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(He(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return ue(this.context.next,this.base,this.pos)}}function He(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function We(n){let e=n.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let i=n.options.simulateBreak,o=n.state.doc.lineAt(t.from),s=i==null||i<=o.from?o.to:Math.min(o.to,i);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==r)return null;if(!a.type.isSkipped){if(a.from>=s)return null;let c=/^ */.exec(o.text.slice(t.to-o.from))[0].length;return{from:t.from,to:t.to+c}}l=a.to}}function Re({closing:n,align:e=!0,units:t=1}){return r=>de(r,e,t,n)}function de(n,e,t,r,i){let o=n.textAfter,s=o.match(/^\s*/)[0].length,l=r&&o.slice(s,s+r.length)==r||i==n.pos+s,a=e?We(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}const Ue=n=>n.baseIndent;function Ve({except:n,units:e=1}={}){return t=>{let r=n&&n.test(t.textAfter);return t.baseIndent+(r?0:e*t.unit)}}const $e=200;function qe(){return h.EditorState.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:r}=n.newSelection.main,i=t.lineAt(r);if(r>i.from+$e)return n;let o=t.sliceString(i.from,r);if(!e.some(c=>c.test(o)))return n;let{state:s}=n,l=-1,a=[];for(let{head:c}of s.selection.ranges){let f=s.doc.lineAt(c);if(f.from==l)continue;l=f.from;let g=ce(s,f.from);if(g==null)continue;let y=/^\s*/.exec(f.text)[0],m=le(s,g);y!=m&&a.push({from:f.from,to:f.from+y.length,insert:m})}return a.length?[n,{changes:a,sequential:!0}]:n})}const he=h.Facet.define(),ge=new p.NodeProp;function je(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function Ge(n,e,t){let r=b(n);if(r.length<t)return null;let i=r.resolveStack(t,1),o=null;for(let s=i;s;s=s.next){let l=s.node;if(l.to<=t||l.from>t)continue;if(o&&l.from<e)break;let a=l.type.prop(ge);if(a&&(l.to<r.length-50||r.length==n.doc.length||!ze(l))){let c=a(l,n);c&&c.from<=t&&c.from>=e&&c.to>t&&(o=c)}}return o}function ze(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function N(n,e,t){for(let r of n.facet(he)){let i=r(n,e,t);if(i)return i}return Ge(n,e,t)}function pe(n,e){let t=e.mapPos(n.from,1),r=e.mapPos(n.to,-1);return t>=r?void 0:{from:t,to:r}}const E=h.StateEffect.define({map:pe}),P=h.StateEffect.define({map:pe});function me(n){let e=[];for(let{head:t}of n.state.selection.ranges)e.some(r=>r.from<=t&&r.to>=t)||e.push(n.lineBlockAt(t));return e}const S=h.StateField.define({create(){return d.Decoration.none},update(n,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((t,r)=>n=Y(n,t,r)),n=n.map(e.changes);for(let t of e.effects)if(t.is(E)&&!Je(n,t.value.from,t.value.to)){let{preparePlaceholder:r}=e.state.facet(xe),i=r?d.Decoration.replace({widget:new Xe(r(e.state,t.value))}):Z;n=n.update({add:[i.range(t.value.from,t.value.to)]})}else t.is(P)&&(n=n.update({filter:(r,i)=>t.value.from!=r||t.value.to!=i,filterFrom:t.value.from,filterTo:t.value.to}));return e.selection&&(n=Y(n,e.selection.main.head)),n},provide:n=>d.EditorView.decorations.from(n),toJSON(n,e){let t=[];return n.between(0,e.doc.length,(r,i)=>{t.push(r,i)}),t},fromJSON(n){if(!Array.isArray(n)||n.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<n.length;){let r=n[t++],i=n[t++];if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid JSON for fold state");e.push(Z.range(r,i))}return d.Decoration.set(e,!0)}});function Y(n,e,t=e){let r=!1;return n.between(e,t,(i,o)=>{i<t&&o>e&&(r=!0)}),r?n.update({filterFrom:e,filterTo:t,filter:(i,o)=>i>=t||o<=e}):n}function O(n,e,t){var r;let i=null;return(r=n.field(S,!1))===null||r===void 0||r.between(e,t,(o,s)=>{(!i||i.from>o)&&(i={from:o,to:s})}),i}function Je(n,e,t){let r=!1;return n.between(e,e,(i,o)=>{i==e&&o==t&&(r=!0)}),r}function ke(n,e){return n.field(S,!1)?e:e.concat(h.StateEffect.appendConfig.of(J()))}const ye=n=>{for(let e of me(n)){let t=N(n.state,e.from,e.to);if(t)return n.dispatch({effects:ke(n.state,[E.of(t),we(n,t)])}),!0}return!1},be=n=>{if(!n.state.field(S,!1))return!1;let e=[];for(let t of me(n)){let r=O(n.state,t.from,t.to);r&&e.push(P.of(r),we(n,r,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function we(n,e,t=!0){let r=n.state.doc.lineAt(e.from).number,i=n.state.doc.lineAt(e.to).number;return d.EditorView.announce.of(`${n.state.phrase(t?"Folded lines":"Unfolded lines")} ${r} ${n.state.phrase("to")} ${i}.`)}const Se=n=>{let{state:e}=n,t=[];for(let r=0;r<e.doc.length;){let i=n.lineBlockAt(r),o=N(e,i.from,i.to);o&&t.push(E.of(o)),r=(o?n.lineBlockAt(o.to):i).to+1}return t.length&&n.dispatch({effects:ke(n.state,t)}),!!t.length},ve=n=>{let e=n.state.field(S,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,n.state.doc.length,(r,i)=>{t.push(P.of({from:r,to:i}))}),n.dispatch({effects:t}),!0},Ke=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:ye},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:be},{key:"Ctrl-Alt-[",run:Se},{key:"Ctrl-Alt-]",run:ve}],Qe={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},xe=h.Facet.define({combine(n){return h.combineConfig(n,Qe)}});function J(n){return[S,_e]}function Te(n,e){let{state:t}=n,r=t.facet(xe),i=s=>{let l=n.lineBlockAt(n.posAtDOM(s.target)),a=O(n.state,l.from,l.to);a&&n.dispatch({effects:P.of(a)}),s.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(n,i,e);let o=document.createElement("span");return o.textContent=r.placeholderText,o.setAttribute("aria-label",t.phrase("folded code")),o.title=t.phrase("unfold"),o.className="cm-foldPlaceholder",o.onclick=i,o}const Z=d.Decoration.replace({widget:new class extends d.WidgetType{toDOM(n){return Te(n,null)}}});class Xe extends d.WidgetType{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return Te(e,this.value)}}const Ye={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class R extends d.GutterMarker{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function Ze(n={}){let e={...Ye,...n},t=new R(e,!0),r=new R(e,!1),i=d.ViewPlugin.fromClass(class{constructor(s){this.from=s.viewport.from,this.markers=this.buildMarkers(s)}update(s){(s.docChanged||s.viewportChanged||s.startState.facet(w)!=s.state.facet(w)||s.startState.field(S,!1)!=s.state.field(S,!1)||b(s.startState)!=b(s.state)||e.foldingChanged(s))&&(this.markers=this.buildMarkers(s.view))}buildMarkers(s){let l=new h.RangeSetBuilder;for(let a of s.viewportLineBlocks){let c=O(s.state,a.from,a.to)?r:N(s.state,a.from,a.to)?t:null;c&&l.add(a.from,a.from,c)}return l.finish()}}),{domEventHandlers:o}=e;return[i,d.gutter({class:"cm-foldGutter",markers(s){var l;return((l=s.plugin(i))===null||l===void 0?void 0:l.markers)||h.RangeSet.empty},initialSpacer(){return new R(e,!1)},domEventHandlers:{...o,click:(s,l,a)=>{if(o.click&&o.click(s,l,a))return!0;let c=O(s.state,l.from,l.to);if(c)return s.dispatch({effects:P.of(c)}),!0;let f=N(s.state,l.from,l.to);return f?(s.dispatch({effects:E.of(f)}),!0):!1}}}),J()]}const _e=d.EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class M{constructor(e,t){this.specs=e;let r;function i(l){let a=K.StyleModule.newName();return(r||(r=Object.create(null)))["."+a]=l,a}const o=typeof t.all=="string"?t.all:t.all?i(t.all):void 0,s=t.scope;this.scope=s instanceof k?l=>l.prop(v)==s.data:s?l=>l==s:void 0,this.style=u.tagHighlighter(e.map(l=>({tag:l.tag,class:l.class||i(Object.assign({},l,{tag:null}))})),{all:o}).style,this.module=r?new K.StyleModule(r):null,this.themeType=t.themeType}static define(e,t){return new M(e,t||{})}}const $=h.Facet.define(),Ce=h.Facet.define({combine(n){return n.length?[n[0]]:null}});function U(n){let e=n.facet($);return e.length?e:n.facet(Ce)}function et(n,e){let t=[nt],r;return n instanceof M&&(n.module&&t.push(d.EditorView.styleModule.of(n.module)),r=n.themeType),e!=null&&e.fallback?t.push(Ce.of(n)):r?t.push($.computeN([d.EditorView.darkTheme],i=>i.facet(d.EditorView.darkTheme)==(r=="dark")?[n]:[])):t.push($.of(n)),t}class tt{constructor(e){this.markCache=Object.create(null),this.tree=b(e.state),this.decorations=this.buildDeco(e,U(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=b(e.state),r=U(e.state),i=r!=U(e.startState),{viewport:o}=e.view,s=e.changes.mapPos(this.decoratedTo,1);t.length<o.to&&!i&&t.type==this.tree.type&&s>=o.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=s):(t!=this.tree||e.viewportChanged||i)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=o.to)}buildDeco(e,t){if(!t||!this.tree.length)return d.Decoration.none;let r=new h.RangeSetBuilder;for(let{from:i,to:o}of e.visibleRanges)u.highlightTree(this.tree,t,(s,l,a)=>{r.add(s,l,this.markCache[a]||(this.markCache[a]=d.Decoration.mark({class:a})))},i,o);return r.finish()}}const nt=h.Prec.high(d.ViewPlugin.fromClass(tt,{decorations:n=>n.decorations})),rt=M.define([{tag:u.tags.meta,color:"#404740"},{tag:u.tags.link,textDecoration:"underline"},{tag:u.tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:u.tags.emphasis,fontStyle:"italic"},{tag:u.tags.strong,fontWeight:"bold"},{tag:u.tags.strikethrough,textDecoration:"line-through"},{tag:u.tags.keyword,color:"#708"},{tag:[u.tags.atom,u.tags.bool,u.tags.url,u.tags.contentSeparator,u.tags.labelName],color:"#219"},{tag:[u.tags.literal,u.tags.inserted],color:"#164"},{tag:[u.tags.string,u.tags.deleted],color:"#a11"},{tag:[u.tags.regexp,u.tags.escape,u.tags.special(u.tags.string)],color:"#e40"},{tag:u.tags.definition(u.tags.variableName),color:"#00f"},{tag:u.tags.local(u.tags.variableName),color:"#30a"},{tag:[u.tags.typeName,u.tags.namespace],color:"#085"},{tag:u.tags.className,color:"#167"},{tag:[u.tags.special(u.tags.variableName),u.tags.macroName],color:"#256"},{tag:u.tags.definition(u.tags.propertyName),color:"#00c"},{tag:u.tags.comment,color:"#940"},{tag:u.tags.invalid,color:"#f00"}]),it=d.EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),Pe=1e4,Ae="()[]{}",De=h.Facet.define({combine(n){return h.combineConfig(n,{afterCursor:!0,brackets:Ae,maxScanDistance:Pe,renderMatch:at})}}),ot=d.Decoration.mark({class:"cm-matchingBracket"}),st=d.Decoration.mark({class:"cm-nonmatchingBracket"});function at(n){let e=[],t=n.matched?ot:st;return e.push(t.range(n.start.from,n.start.to)),n.end&&e.push(t.range(n.end.from,n.end.to)),e}const lt=h.StateField.define({create(){return d.Decoration.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],r=e.state.facet(De);for(let i of e.state.selection.ranges){if(!i.empty)continue;let o=D(e.state,i.head,-1,r)||i.head>0&&D(e.state,i.head-1,1,r)||r.afterCursor&&(D(e.state,i.head,1,r)||i.head<e.state.doc.length&&D(e.state,i.head+1,-1,r));o&&(t=t.concat(r.renderMatch(o,e.state)))}return d.Decoration.set(t,!0)},provide:n=>d.EditorView.decorations.from(n)}),ct=[lt,it];function ft(n={}){return[De.of(n),ct]}const Ie=new p.NodeProp;function q(n,e,t){let r=n.prop(e<0?p.NodeProp.openedBy:p.NodeProp.closedBy);if(r)return r;if(n.name.length==1){let i=t.indexOf(n.name);if(i>-1&&i%2==(e<0?1:0))return[t[i+e]]}return null}function j(n){let e=n.type.prop(Ie);return e?e(n.node):n}function D(n,e,t,r={}){let i=r.maxScanDistance||Pe,o=r.brackets||Ae,s=b(n),l=s.resolveInner(e,t);for(let a=l;a;a=a.parent){let c=q(a.type,t,o);if(c&&a.from<a.to){let f=j(a);if(f&&(t>0?e>=f.from&&e<f.to:e>f.from&&e<=f.to))return ut(n,e,t,a,f,c,o)}}return dt(n,e,t,s,l.type,i,o)}function ut(n,e,t,r,i,o,s){let l=r.parent,a={from:i.from,to:i.to},c=0,f=l==null?void 0:l.cursor();if(f&&(t<0?f.childBefore(r.from):f.childAfter(r.to)))do if(t<0?f.to<=r.from:f.from>=r.to){if(c==0&&o.indexOf(f.type.name)>-1&&f.from<f.to){let g=j(f);return{start:a,end:g?{from:g.from,to:g.to}:void 0,matched:!0}}else if(q(f.type,t,s))c++;else if(q(f.type,-t,s)){if(c==0){let g=j(f);return{start:a,end:g&&g.from<g.to?{from:g.from,to:g.to}:void 0,matched:!1}}c--}}while(t<0?f.prevSibling():f.nextSibling());return{start:a,matched:!1}}function dt(n,e,t,r,i,o,s){let l=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),a=s.indexOf(l);if(a<0||a%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},f=n.doc.iterRange(e,t>0?n.doc.length:0),g=0;for(let y=0;!f.next().done&&y<=o;){let m=f.value;t<0&&(y+=m.length);let x=e+y*t;for(let T=t>0?0:m.length-1,Ne=t>0?m.length:-1;T!=Ne;T+=t){let L=s.indexOf(m[T]);if(!(L<0||r.resolveInner(x+T,1).type!=i))if(L%2==0==t>0)g++;else{if(g==1)return{start:c,end:{from:x+T,to:x+T+1},matched:L>>1==a>>1};g--}}t>0&&(y+=m.length)}return f.done?{start:c,matched:!1}:null}const ht=Object.create(null),_=[p.NodeType.none],ee=[],te=Object.create(null),gt=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])gt[n]=pt(ht,e);function V(n,e){ee.indexOf(n)>-1||(ee.push(n),console.warn(e))}function pt(n,e){let t=[];for(let l of e.split(" ")){let a=[];for(let c of l.split(".")){let f=n[c]||u.tags[c];f?typeof f=="function"?a.length?a=a.map(f):V(c,`Modifier ${c} used at start of tag`):a.length?V(c,`Tag ${c} used as modifier`):a=Array.isArray(f)?f:[f]:V(c,`Unknown highlighting tag ${c}`)}for(let c of a)t.push(c)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),i=r+" "+t.map(l=>l.id),o=te[i];if(o)return o.id;let s=te[i]=p.NodeType.define({id:_.length,name:r,props:[u.styleTags({[r]:t})]});return _.push(s),s.id}d.Direction.RTL,d.Direction.LTR;exports.DocInput=ie;exports.HighlightStyle=M;exports.IndentContext=z;exports.LRLanguage=B;exports.Language=k;exports.LanguageSupport=Me;exports.ParseContext=I;exports.TreeIndentContext=F;exports.bracketMatching=ft;exports.bracketMatchingHandle=Ie;exports.codeFolding=J;exports.continuedIndent=Ve;exports.defaultHighlightStyle=rt;exports.defineLanguageFacet=ne;exports.delimitedIndent=Re;exports.flatIndent=Ue;exports.foldAll=Se;exports.foldCode=ye;exports.foldEffect=E;exports.foldGutter=Ze;exports.foldInside=je;exports.foldKeymap=Ke;exports.foldNodeProp=ge;exports.foldService=he;exports.foldState=S;exports.foldable=N;exports.getIndentUnit=ae;exports.getIndentation=ce;exports.indentNodeProp=fe;exports.indentOnInput=qe;exports.indentService=se;exports.indentString=le;exports.indentUnit=G;exports.language=w;exports.languageDataProp=v;exports.matchBrackets=D;exports.sublanguageProp=re;exports.syntaxHighlighting=et;exports.syntaxTree=b;exports.unfoldAll=ve;exports.unfoldCode=be;exports.unfoldEffect=P;
//# sourceMappingURL=index.js.map
